name: Polymarket repo stats (hourly)

on:
  workflow_dispatch:
  schedule:
    - cron: "13 * * * *"  # every hour at HH:13 (UTC)

concurrency:
  group: polymarket-repo-stats-hourly
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (this repo)
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Run stats
        env:
          ORG: "statground"
          ORG_MODE: "auto"  # auto|org|user
          REPO_PREFIX: "Statground_Data_Polymarket"
          DEFAULT_BRANCH: "main"
          OUT_MD: "POLYMARKET_REPO_STATS.md"
          GH_READ_TOKEN: ${{ secrets.POLYMARKET_READ_TOKEN }}
        run: |
          python scripts/update_repo_stats.py

      - name: Commit & push if changed
        run: |
          set -e

          # Stage the md (includes first-run untracked file)
          git add POLYMARKET_REPO_STATS.md

          # If nothing staged/changed (including untracked), skip.
          if [ -z "$(git status --porcelain)" ]; then
            echo "No changes."
            exit 0
          fi

          git config user.name "statground-bot"
          git config user.email "statground-bot@users.noreply.github.com"

          git commit -m "Update Polymarket repo stats"
          git push
